#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit security checks..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# 1. Lint Solidity code
echo "ğŸ“ Step 1/5: Linting Solidity files..."
npm run lint || {
  echo "âŒ Solidity linting failed. Please fix errors before committing."
  exit 1
}

# 2. Check code formatting
echo "âœ¨ Step 2/5: Checking code formatting..."
npm run format:check || {
  echo "âŒ Code formatting check failed. Run 'npm run format' to fix."
  exit 1
}

# 3. Lint JavaScript/TypeScript
echo "ğŸ” Step 3/5: Linting JavaScript/TypeScript..."
npx eslint scripts/ test/ --ext .js,.ts || {
  echo "âŒ ESLint check failed. Please fix errors before committing."
  exit 1
}

# 4. Run tests
echo "ğŸ§ª Step 4/5: Running tests..."
npm test || {
  echo "âŒ Tests failed. Please fix failing tests before committing."
  exit 1
}

# 5. Security audit
echo "ğŸ”’ Step 5/5: Running security audit..."
npm audit --audit-level=high || {
  echo "âš ï¸  Security vulnerabilities detected. Please review and fix."
  echo "   Run 'npm audit fix' to attempt automatic fixes."
  # Don't fail on audit, just warn
}

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… All pre-commit checks passed!"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
