#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push checks..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# 1. Compile contracts
echo "ğŸ”¨ Step 1/3: Compiling contracts..."
npm run compile || {
  echo "âŒ Contract compilation failed."
  exit 1
}

# 2. Run full test suite with coverage
echo "ğŸ“Š Step 2/3: Running tests with coverage..."
npm run test:coverage || {
  echo "âŒ Tests or coverage failed."
  exit 1
}

# 3. Check for sensitive data
echo "ğŸ” Step 3/3: Checking for sensitive data..."

# Check for private keys
if git diff --cached | grep -i "private.*key.*=.*0x[0-9a-fA-F]\{64\}"; then
  echo "âŒ ERROR: Private key detected in commit!"
  echo "   Never commit private keys to version control."
  exit 1
fi

# Check for API keys
if git diff --cached | grep -i "api.*key.*=.*[a-zA-Z0-9]\{20,\}"; then
  echo "âš ï¸  WARNING: Possible API key detected in commit."
  echo "   Please verify this is not sensitive data."
fi

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… All pre-push checks passed!"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
